# ‚ú® –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook - –ò—Ç–æ–≥–∏

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–¢–µ–ø–µ—Ä—å **Telegram webhook –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è! –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

## üì¶ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### Backend

1. **`backend/src/services/webhookService.ts`** - –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç webhook –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –¥–ª—è health check

2. **`backend/src/server.ts`** - –û–±–Ω–æ–≤–ª–µ–Ω
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `autoSetupWebhook`
   - –í—ã–∑—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
   - Health endpoint —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å webhook

### Scripts

3. **`backend/src/scripts/setupWebhook.ts`** - –°–∫—Ä–∏–ø—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ö–æ–º–∞–Ω–¥—ã: set, info, delete
   - –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ —Å —ç–º–æ–¥–∑–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

4. **`scripts/post-deploy.sh`** - Post-deploy —Å–∫—Ä–∏–ø—Ç –¥–ª—è Linux/Mac
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç .env
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å backend
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç webhook –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

5. **`scripts/post-deploy.ps1`** - Post-deploy —Å–∫—Ä–∏–ø—Ç –¥–ª—è Windows
   - –¢–æ –∂–µ —Å–∞–º–æ–µ –¥–ª—è PowerShell

6. **`scripts/setup-webhook.ps1`** - –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –¥–ª—è Windows
   - –ß–∏—Ç–∞–µ—Ç .env
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç webhook
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å

### Documentation

7. **`docs/WEBHOOK_AUTO_SETUP.md`** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
8. **`docs/QUICK_START.md`** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
9. **`WEBHOOK_SETUP.md`** - –û–±–Ω–æ–≤–ª–µ–Ω —Å –Ω–æ–≤—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
10. **`AUTO_WEBHOOK_SUMMARY.md`** - –≠—Ç–æ—Ç —Ñ–∞–π–ª

### Configuration

11. **`backend/env.example`** - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `AUTO_SETUP_WEBHOOK`
12. **`ecosystem.config.js`** - –î–æ–±–∞–≤–ª–µ–Ω post-update hook
13. **`backend/package.json`** - –î–æ–±–∞–≤–ª–µ–Ω—ã npm —Å–∫—Ä–∏–ø—Ç—ã:
    - `webhook:setup`
    - `webhook:info`
    - `webhook:delete`

14. **README —Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã:**
    - `README.md`
    - `backend/README.md`
    - `docs/DEPLOYMENT.md`
    - `backend/src/scripts/README.md`

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```env
# –í backend/.env
AUTO_SETUP_WEBHOOK=true
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
TELEGRAM_MANAGER_ID=–≤–∞—à_id
BACKEND_URL=https://–≤–∞—à_–¥–æ–º–µ–Ω.com
```

```bash
# –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 restart backend

# Webhook –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏! ‚ú®
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ï—Å–ª–∏ AUTO_SETUP_WEBHOOK=false –∏–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
npm run webhook:setup
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: Post-deploy —Å–∫—Ä–∏–ø—Ç

```bash
# –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
bash scripts/post-deploy.sh
```

## üìä –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. Health Check —Å webhook —Å—Ç–∞—Ç—É—Å–æ–º

```bash
curl https://yourdomain.com/health
```

```json
{
  "status": "ok",
  "timestamp": 1234567890,
  "webhook": {
    "configured": true,
    "hasErrors": false,
    "pendingUpdates": 0
  }
}
```

### 2. NPM —Å–∫—Ä–∏–ø—Ç—ã

```bash
npm run webhook:setup   # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
npm run webhook:info    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
npm run webhook:delete  # –£–¥–∞–ª–∏—Ç—å
```

### 3. –£–º–Ω–∞—è –∞–≤—Ç–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞

Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **–ù–ï** –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –µ—Å–ª–∏:
- `BACKEND_URL` —Å–æ–¥–µ—Ä–∂–∏—Ç localhost
- `TELEGRAM_BOT_TOKEN` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `AUTO_SETUP_WEBHOOK` –Ω–µ —Ä–∞–≤–µ–Ω `true`

–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å.

### 4. –õ–æ–≥–∏

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ:
```
üîç Checking current webhook configuration...
‚úÖ Webhook auto-configured successfully
üîó URL: https://yourdomain.com/messages/webhook
```

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–æ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ `.env`:

```env
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ webhook –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ true –¥–ª—è production
AUTO_SETUP_WEBHOOK=true
```

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞

### –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥
git pull

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
cd backend
npm install

# 3. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ backend
npm run build

# 4. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ .env
echo "AUTO_SETUP_WEBHOOK=true" >> .env

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
pm2 restart backend

# 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
pm2 logs backend

# –ì–æ—Ç–æ–≤–æ! Webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚úÖ
```

### –ï—Å–ª–∏ –¥–µ–ø–ª–æ–∏—Ç–µ —Å –Ω—É–ª—è:

–ü—Ä–æ—Å—Ç–æ —Å–ª–µ–¥—É–π—Ç–µ –æ–±—ã—á–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é. Webhook –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ!

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–æ:
1. ‚ùå –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. ‚ùå SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. ‚ùå –í—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å `npm run webhook:setup`
4. ‚ùå –õ–µ–≥–∫–æ –∑–∞–±—ã—Ç—å —ç—Ç–æ—Ç —à–∞–≥
5. ‚ùå –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

### –°–µ–π—á–∞—Å:
1. ‚úÖ –î–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. ‚úÖ Webhook –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ä–∞–∑—É!

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. –õ–æ–≥–∏
pm2 logs backend | grep webhook
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: ‚úÖ Webhook auto-configured successfully

# 2. Health endpoint
curl https://yourdomain.com/health | jq .webhook
# {
#   "configured": true,
#   "hasErrors": false,
#   "pendingUpdates": 0
# }

# 3. Webhook info
cd backend
npm run webhook:info
# ‚úÖ Webhook is set

# 4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É
# –î–æ–ª–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä—É
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤:

- **[docs/QUICK_START.md](docs/QUICK_START.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- **[docs/WEBHOOK_AUTO_SETUP.md](docs/WEBHOOK_AUTO_SETUP.md)** - –î–µ—Ç–∞–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- **[WEBHOOK_SETUP.md](WEBHOOK_SETUP.md)** - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
- **[backend/README.md](backend/README.md)** - Backend –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **[docs/DEPLOYMENT.md](docs/DEPLOYMENT.md)** - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   cat backend/.env | grep -E 'TELEGRAM|BACKEND_URL|AUTO_SETUP'
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   pm2 logs backend --lines 100 | grep webhook
   ```

3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤—Ä—É—á–Ω—É—é:**
   ```bash
   cd backend
   npm run webhook:setup
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:**
   ```bash
   curl https://yourdomain.com/health
   ```

5. **–°–º. [WEBHOOK_SETUP.md](WEBHOOK_SETUP.md)** –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ troubleshooting

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **Production:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `AUTO_SETUP_WEBHOOK=true`
2. **Development:** –ú–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å `AUTO_SETUP_WEBHOOK=false` –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é —Å ngrok
3. **CI/CD:** Webhook –Ω–∞—Å—Ç—Ä–æ–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–ø–ª–æ–µ
4. **Monitoring:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ health endpoint –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å–∞ webhook

## ‚úÖ –†–µ–∑—é–º–µ

–¢–µ–ø–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –±–æ—Ç–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–ª–æ—è!

–ü—Ä–æ—Å—Ç–æ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `backend/.env` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
- ‚úÖ `AUTO_SETUP_WEBHOOK=true`
- ‚úÖ `TELEGRAM_BOT_TOKEN`
- ‚úÖ `TELEGRAM_MANAGER_ID`
- ‚úÖ `BACKEND_URL` (—Å HTTPS)

–ò –≤—Å–µ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ
